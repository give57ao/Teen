<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.ez.board.mapper.BoardMapper">
 
 <select id="getList" resultType="com.ez.board.model.BoardModel">
	select * from mp_board
  </select>
 
 <select id ="selectBoard" resultType="com.ez.board.model.BoardModel">
 SELECT bno, title, writer, regdate 
		FROM (
			SELECT ROWNUM RN, A.* 
				FROM (
						SELECT *
						FROM mp_board 
						ORDER BY bno DESC 
						) A
				)
	WHERE RN BETWEEN #{start} AND #{end}
 </select>
 
 <select id="countBoard" resultType="int">
 SELECT COUNT(*) FROM mp_board
 </select>
 
 <insert id="registNewBoard" parameterType="com.ez.board.model.BoardModel" useGeneratedKeys="true" keyProperty="bno">
 <selectKey keyProperty="bno" resultType="int" order="BEFORE">
 	    	SELECT MP_BOARD_SEQ.NEXTVAL FROM DUAL
 </selectKey>
 INSERT INTO MP_BOARD(
 								BNO 
	   					      , TITLE 
	   					      , CONTENT 
	   					      , WRITER  )	
	                 VALUES(   
	                 			 MP_BOARD_SEQ.NEXTVAL 
	                 		  , #{title}
	                 		  , #{content}
	                 		  , #{writer}  )
 </insert>
 
   <insert id="insertFile" parameterType="hashMap">
		INSERT INTO MP_FILE(
			FILE_NO,
			BNO,
			ORG_FILE_NAME,
			STORED_FILE_NAME,
			FILE_SIZE
		)VALUES(
			SEQ_MP_FILE_NO.NEXTVAL,
			#{BNO},
			#{ORG_FILE_NAME},
			#{STORED_FILE_NAME},
			#{FILE_SIZE}
		)
    </insert>
    
    <select id="readBoard" parameterType="int" resultType="com.ez.board.model.BoardModel">
		SELECT	BNO
			  , TITLE
			  , CONTENT
			  , WRITER
			  , REGDATE
		 FROM MP_BOARD
		 WHERE BNO = #{bno}
	</select>
    
    <select id="selectFileList" parameterType="int" resultType="hashMap">
	SELECT FILE_NO,
		   ORG_FILE_NAME,
		   ROUND(FILE_SIZE/1024,1) AS FILE_SIZE
	  FROM MP_FILE
	 WHERE BNO = #{BNO}
	   AND DEL_GB = 'N'
</select>
    
    <select id="selectFileInfo" parameterType="hashMap" resultType="hashMap">
    SELECT 
		STORED_FILE_NAME,
		ORG_FILE_NAME
	FROM MP_FILE
	WHERE FILE_NO = #{FILE_NO}
	</select>
    
  </mapper>